<!doctype html>
<html>
  <head>
      <!--per ricaricare sempre la pagina da zero e non usare la cache-->
      <META HTTP-EQUIV=”Pragma” CONTENT=”no-cache”>
      <META HTTP-EQUIV=”Cache-Control” CONTENT=”no-cache”>
      <link rel="stylesheet" type="text/css" href="css/style.css">
      <title>WebGLMiniArcade</title> 

      
   </head>
   
    <body>
        <div id="container" >            
            <canvas id="gamePanel"></canvas>
            <canvas id="controlPanel"></canvas>
        </div>       
        <script id="vertex-shader" type="x-shader/x-vertex">
            attribute  vec3 vPosition;
            attribute  vec3 vColor;
            varying vec4 fColor;
            
            uniform mat4 modelView;
            uniform mat4 projection;
            
            void main() 
            {
                gl_Position = projection*modelView*vec4(vPosition, 1.0);
                fColor =vec4(vColor, 1.0);
            } 
            </script>
            
            <script id="fragment-shader" type="x-shader/x-fragment">
            precision mediump float;            
            varying vec4 fColor;            
            void
            main()
            {
                gl_FragColor = fColor;
            }
            </script>
    </body>




    
    <script type="text/javascript" src="lib/utility.js"></script>
    <script type="text/javascript" src="lib/Panel2D.js"></script>
    <script type="text/javascript" src="lib/WebGLController.js"></script>
    <script type="text/javascript" src="lib/Obj3D.js"></script>

    <script type="text/javascript" src="resources/subdiv.js"></script>
  <script type="text/javascript" src="resources/mesh_utils.js"></script>
  <script type="text/javascript" src="resources/webgl-utils.js"></script>
  <script type="text/javascript" src="resources/m4.js"></script>      
  <script  type="text/javascript" src="resources/glm_light.js"></script>

  <script type="text/javascript" src="webgl-debug.js"></script>

    <script type="text/javascript">
        function dinamicResize(){
            var cp = document.getElementById("controlPanel");
            var gp = document.getElementById("gamePanel");
            cp.width=cp.clientWidth;
            cp.height=cp.clientHeight;
            gp.width=gp.clientWidth;
            gp.height=gp.clientHeight; 
        }       
        var ControlPanel = new Panel2D(document.getElementById("controlPanel"));
        var objs=[];
        var car =new Obj3D('http://11.0.0.15/cg/Esame/3D/gt86/Gt86_5000poly_closed.obj');
        var pista =new Obj3D('http://11.0.0.15/cg/Esame/3D/pista.obj',true);
        var cubo =new Obj3D('http://11.0.0.15/cg/Esame/3D/c.obj',true);
        objs.push(car);
        objs.push(pista);
        //objs.push(car);
        var GamePanel = new WebGLController(document.getElementById("gamePanel"),objs);
        GamePanel.requestAnimationEnabled=true;
        dinamicResize();
        window.addEventListener("resize",dinamicResize);
    </script>
    <script type="text/javascript">
        //PER FACILITARE IL DEBUG
        window.render2D= ControlPanel.render;            
        window.renderGL= GamePanel.render;
        window.showParam=function(){
            console.log("------------------GamePanel.param----");
            console.log("near",GamePanel.near);
            console.log("far",GamePanel.far);
            console.log("(??)radius",GamePanel.radius);
            console.log("(angolo y) theta°",radToDeg(GamePanel.theta));
            console.log("(angolo x) phi°",radToDeg(GamePanel.phi));
            console.log("(??)dr",GamePanel.dr);
            console.log("(asse z) fov",GamePanel.fov);
            console.log("------------------GamePanel.param----");
        }
        window.setParam=function(name,value,convertDegToRad=false,stamp=true){
            if(convertDegToRad){
                GamePanel[name]=degToRad(value);
            }else{
                GamePanel[name]=value;
            }           
            if(stamp){
                window.showParam();
            }
        }
        window.setParam("phi",0.001,true);
        window.setParam("theta",0.001,true);
        window.setParam("far",2000);
        window.setParam("fov",2000);
        ControlPanel.render();
        StartWhenReady(objs,function(){GamePanel.render();});
    </script>

    
</html>